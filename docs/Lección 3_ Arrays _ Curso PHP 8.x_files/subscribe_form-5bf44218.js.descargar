var F=Object.defineProperty,T=Object.defineProperties;var Y=Object.getOwnPropertyDescriptors;var $=Object.getOwnPropertySymbols;var N=Object.prototype.hasOwnProperty,j=Object.prototype.propertyIsEnumerable;var E=(e,t,a)=>t in e?F(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a,y=(e,t)=>{for(var a in t||(t={}))N.call(t,a)&&E(e,a,t[a]);if($)for(var a of $(t))j.call(t,a)&&E(e,a,t[a]);return e},I=(e,t)=>T(e,Y(t));var L=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports);var f=(e,t,a)=>new Promise((p,m)=>{var g=b=>{try{l(a.next(b))}catch(h){m(h)}},i=b=>{try{l(a.throw(b))}catch(h){m(h)}},l=b=>b.done?p(b.value):Promise.resolve(b.value).then(g,i);l((a=a.apply(e,t)).next())});import"./_sentry-release-injector-d3de7f4c.js";import{bX as w,bY as S,Y as _,bQ as P,bR as U,aU as A,aH as r,G as u,H as d,A as n,D as s,b6 as c,ar as q,bD as V,F as M,aS as K,P as o,aL as D,aI as H,cD as z,c7 as R,ee as G,ei as W,ek as X,el as Q,f as J,z as Z}from"./base-f9c708e2.js";var Le=L(O=>{const x=["utm_source","utm_medium","utm_campaign","utm_term","utm_content"],ee=e=>Object.fromEntries(e.split("; ").map(t=>t.split(/=(.*)$/,2).map(decodeURIComponent))),te=(e,t)=>Object.fromEntries(Object.entries(e).filter(([a])=>t.includes(a))),re=()=>te(ee(document.cookie),x),se=(e,t,a,p)=>f(O,null,function*(){var l,b;const m=p?{referring_subscriber_id:p}:{},g=y(y(y({email:e,tags:new URLSearchParams(document.location.search).getAll("tag"),metadata:t},m),re()),Object.fromEntries(new URLSearchParams(location.search)));let i;try{i=(yield w.post(S["api:create_subscriber"](),g,{headers:{Authorization:`Token ${a.id}`}})).data}catch(h){return{error:(b=(l=h.response)==null?void 0:l.data)==null?void 0:b.error}}return window.plausible?window.plausible("Subscribe"):window.fathom&&a.fathom_subscribe_code&&window.fathom.trackGoal(a.fathom_subscribe_code,0),{subscriber:i}}),k=(e,t,a)=>t?e.domain===""?`/${e.username}/subscribers/${t.id}${a}`:`/subscribers/${t.id}${a}`:null,ie=e=>e.endsWith("/")?e.toString().split("/").reverse()[1]:e.toString().split("/").reverse()[0],ae=_({components:{FontAwesomeIcon:P},computed:{tinted(){return TINT_COLOR!=="#0069FF"}},props:{href:String,text:String,color:{type:String,required:!0},pending:{type:Boolean,default:!1},icon:{type:Object}}}),ne=["href"],oe={class:"absolute"},ue={style:{flex:"1","text-align":"center"}};function le(e,t,a,p,m,g){const i=A("font-awesome-icon");return r(),u("a",{type:"button",href:e.href,target:"_blank",class:q({tinted:e.tinted,yellow:e.color==="yellow",green:e.color==="green",blue:e.color==="blue",red:e.color==="red",pending:e.pending})},[d("div",oe,[e.icon?(r(),n(i,{key:e.icon.toString(),icon:e.icon,"fixed-width":""},null,8,["icon"])):s("",!0),e.pending?(r(),n(i,{key:1,icon:"spinner",spin:!0,"fixed-width":""})):s("",!0)]),d("div",ue,c(e.text),1)],10,ne)}const de=U(ae,[["render",le],["__scopeId","data-v-374179fa"]]),be=_({components:{"action-button":de},props:{newsletter:{type:Object,required:!0},subscriber:{type:Object},stripePublicKey:{type:String,required:!0},state:{type:String,required:!0},variant:{type:String,required:!0},emailAddress:{type:String,required:!0},metadata:{type:Object,required:!0},confirmEmailAddress:{type:Function,required:!0},checkSubscriber:{type:Function,required:!0},subscribe:{type:Function,required:!0},resubscribe:{type:Function,required:!0},error:String},emits:["update:emailAddress","update:metadata"],computed:{upgradeUrl(){return k(this.newsletter,this.subscriber,"/upgrade/monthly")},manageSubscriptionUrl(){return this.subscriber?`/api/emails/manage-premium-subscription/${this.subscriber.id}`:null},archiveUrl(){return this.newsletter.should_expose_public_archives?k(this.newsletter,this.subscriber,"/archive"):null},emailUrl(){if(!(this.newsletter.should_expose_public_archives||this.newsletter.should_expose_individual_archives))return null;const e=ie(window.location.href);return k(this.newsletter,this.subscriber,`/archive/${e}`)}},methods:{handleInput(e){const t=e.target;this.$emit("update:emailAddress",t.value)},handleMetadataInput(e,t){const a=t.target;this.$emit("update:metadata",I(y({},this.metadata),{[e]:a.value}))}}}),ce=e=>(D("data-v-73c1b856"),e=e(),H(),e),pe={style:{"text-align":"center","font-size":"1.125rem","line-height":"1.75rem"}},me=ce(()=>d("input",{type:"submit",value:"submit",style:{position:"absolute",left:"-9999px"}},null,-1)),he=["value","required","placeholder","readonly","onInput"],fe=["value","readonly"],ge={key:1},ye={key:2},we={key:3},ke={key:4},ve={key:5},Se={key:6},_e={key:7},Ue={key:8},Ae={key:9},Ce={key:10},$e={key:11},Ee={key:12},Ie={key:13},Re={key:14},qe={key:15},Be={class:"button-container"};function Oe(e,t,a,p,m,g){const i=A("action-button");return r(),u("div",{class:q({widget:!0,"widget--success":e.state==="premium"||e.state==="gifted","widget--warning":e.state==="unactivated"||e.state==="paused"||e.state==="trialed"||e.state==="unsubscribed"||e.state==="past_due"||e.state==="churned"||e.state==="churning","widget--error":e.state==="spammy"||e.state==="disabled"||e.state==="errored_email"||e.state==="invalid_email"||e.state==="invalid_subscription"||e.state==="pending_email_address_confirmation"||e.state==="awaiting_email_address_confirmation"})},[d("div",pe,[e.state==="not_subscribed"||e.state==="pending_subscription"||e.state==="pending_validation"||e.state==="errored_email"||e.state==="invalid_email"||e.state==="invalid_subscription"?(r(),u("form",{key:0,onSubmit:t[1]||(t[1]=V((...l)=>e.subscribe&&e.subscribe(...l),["prevent"]))},[me,(r(!0),u(M,null,K(e.newsletter.metadata_fields,(l,b)=>(r(),u("input",{key:b,value:e.metadata[l.key],type:"text",required:l.is_required,placeholder:l.placeholder,readonly:e.state==="pending_subscription",onInput:h=>e.handleMetadataInput(l.key,h)},null,40,he))),128)),d("input",{id:"email",required:"",value:e.emailAddress,type:"email",placeholder:"Your email (you@example.com)",readonly:e.state==="pending_subscription",onInput:t[0]||(t[0]=(...l)=>e.handleInput&&e.handleInput(...l))},null,40,fe)],32)):s("",!0),e.state==="unpaid"?(r(),u("span",ge,[o(" To finish subscribing to "),d("strong",null,c(e.newsletter.name),1),o(", click below to upgrade your subscription. ")])):s("",!0),e.state==="regular"&&e.newsletter.should_enable_paid_subscriptions?(r(),u("span",ye,[o(" You're subscribed to "),d("strong",null,c(e.newsletter.name),1),o(", but can upgrade to a paid subscription if you'd like! ")])):e.state==="regular"?(r(),u("span",we,[o(" You're subscribed to "),d("strong",null,c(e.newsletter.name),1),o("! ")])):s("",!0),e.state==="trialed"?(r(),u("span",ke,[o(" You're currently on a free trial of "),d("strong",null,c(e.newsletter.name),1),o(". ")])):s("",!0),e.state==="unsubscribed"?(r(),u("span",ve,[o(" You unsubscribed from "),d("strong",null,c(e.newsletter.name),1),o(". ")])):s("",!0),e.state==="past_due"?(r(),u("span",Se,[o(" Your payment to "),d("strong",null,c(e.newsletter.name),1),o(" is past due! ")])):s("",!0),e.state==="churned"?(r(),u("span",_e,[o(" Your premium subscription to "),d("strong",null,c(e.newsletter.name),1),o(" has expired, but you can upgrade again if you'd like. ")])):s("",!0),e.state==="churning"?(r(),u("span",Ue,[o(" Your premium subscription to "),d("strong",null,c(e.newsletter.name),1),o(" will expire at the end of the current billing cycle. ")])):s("",!0),e.state==="paused"?(r(),u("span",Ae," You've paused your subscription, but you can resume it if you'd like! ")):s("",!0),e.state==="unactivated"?(r(),u("span",Ce," Please check your inbox for a confirmation email! ")):s("",!0),e.state==="premium"?(r(),u("span",$e,[o(" You're now logged in as a premium subscriber of "),d("strong",null,c(e.newsletter.name),1),o("! ")])):s("",!0),e.state==="gifted"?(r(),u("span",Ee,[o(" The author of "),d("strong",null,c(e.newsletter.name),1),o(" has gifted you a free premium subscription. ")])):s("",!0),e.state==="disabled"?(r(),u("span",Ie," You cannot subscribe to this newsletter. ")):s("",!0),e.state==="spammy"||e.state==="pending_email_address_confirmation"?(r(),u("span",Re," Your email address has been marked as spammy. ")):s("",!0),e.state==="awaiting_email_address_confirmation"?(r(),u("span",qe," Check your inbox for an email to confirm your address. ")):s("",!0)]),d("div",Be,[e.state==="pending_validation"?(r(),n(i,{key:0,text:"Validating...",color:"blue",pending:!0})):s("",!0),e.state==="pending_subscription"?(r(),n(i,{key:1,text:e.newsletter.subscription_button_text||(e.newsletter.paid_subscription_free_trial_duration?"Subscribe and start a free trial":"Subscribe"),color:"blue",pending:"",onClick:e.subscribe},null,8,["text","onClick"])):s("",!0),e.state==="not_subscribed"?(r(),n(i,{key:2,text:e.newsletter.subscription_button_text||(e.newsletter.paid_subscription_free_trial_duration?`Subscribe and start a free trial for ${e.newsletter.paid_subscription_free_trial_duration} days`:"Subscribe"),color:"blue",onClick:e.subscribe},null,8,["text","onClick"])):s("",!0),e.state==="unsubscribed"?(r(),n(i,{key:3,text:"Resubscribe",color:"yellow",onClick:t[2]||(t[2]=()=>e.subscriber&&e.resubscribe(e.subscriber.id))})):s("",!0),e.state==="invalid_subscription"?(r(),n(i,{key:4,text:"That email didn't work! Please try another",color:"red",disabled:""})):s("",!0),e.state==="unactivated"?(r(),n(i,{key:5,text:"I've confirmed my email",color:"yellow",onClick:e.checkSubscriber},null,8,["onClick"])):s("",!0),e.state==="trialed"&&e.upgradeUrl?(r(),n(i,{key:6,href:e.upgradeUrl,text:"Upgrade subscription",color:"yellow"},null,8,["href"])):s("",!0),(e.state==="unpaid"||e.state==="regular"&&e.newsletter.should_enable_paid_subscriptions)&&e.upgradeUrl?(r(),n(i,{key:7,href:e.upgradeUrl,text:{archive_page:"Read full article",subscribe_page:"Upgrade subscription"}[e.variant],color:"blue"},null,8,["href","text"])):s("",!0),e.state==="past_due"&&e.manageSubscriptionUrl?(r(),n(i,{key:8,href:e.manageSubscriptionUrl,text:"Manage subscription",color:"yellow"},null,8,["href"])):s("",!0),e.state==="churning"&&e.manageSubscriptionUrl?(r(),n(i,{key:9,href:e.manageSubscriptionUrl,text:"Manage subscription",color:"yellow"},null,8,["href"])):s("",!0),e.state==="churned"&&e.upgradeUrl?(r(),n(i,{key:10,href:e.upgradeUrl,text:"Upgrade subscription",color:"yellow"},null,8,["href"])):s("",!0),e.state==="paused"&&e.manageSubscriptionUrl?(r(),n(i,{key:11,href:e.manageSubscriptionUrl,text:"Manage subscription",color:"yellow"},null,8,["href"])):s("",!0),e.state==="premium"&&e.manageSubscriptionUrl?(r(),n(i,{key:12,href:e.manageSubscriptionUrl,text:"Manage subscription",color:"green"},null,8,["href"])):s("",!0),e.state==="regular"&&e.archiveUrl?(r(),n(i,{key:13,href:e.archiveUrl,text:"View archives",color:"blue"},null,8,["href"])):s("",!0),e.state==="churning"&&e.archiveUrl?(r(),n(i,{key:14,href:e.archiveUrl,text:"View archives",color:"yellow"},null,8,["href"])):s("",!0),(e.state==="premium"||e.state==="gifted"||e.state==="churning")&&e.archiveUrl&&e.variant==="subscribe_page"?(r(),n(i,{key:15,href:e.archiveUrl,text:"View archives",color:"green"},null,8,["href"])):s("",!0),(e.state==="premium"||e.state==="gifted"||e.state==="churning")&&e.emailUrl&&e.variant==="archive_page"?(r(),n(i,{key:16,href:e.emailUrl,text:"Read full article",color:"green"},null,8,["href"])):s("",!0),e.state==="disabled"?(r(),n(i,{key:17,href:`mailto:${e.newsletter.email_address}`,text:"Contact author",color:"red"},null,8,["href"])):s("",!0),e.state==="errored_email"?(r(),n(i,{key:18,text:e.error,color:"red"},null,8,["text"])):s("",!0),e.state==="spammy"||e.state==="invalid_email"||e.state==="pending_email_address_confirmation"?(r(),n(i,{key:19,pending:e.state==="pending_email_address_confirmation",text:"Confirm email",color:"red",onClick:e.confirmEmailAddress},null,8,["pending","onClick"])):s("",!0),e.state==="awaiting_email_address_confirmation"?(r(),n(i,{key:20,text:"I confirmed my email!",color:"red",onClick:e.handleInput},null,8,["onClick"])):s("",!0),e.state==="spammy"||e.state==="pending_email_address_confirmation"?(r(),n(i,{key:21,href:`mailto:${e.newsletter.email_address}`,text:"Contact author",color:"red"},null,8,["href"])):s("",!0)])],2)}const Fe=U(be,[["render",Oe],["__scopeId","data-v-73c1b856"]]),v=e=>e==null?"not_subscribed":e.subscriber_type,Te=_({components:{SubscribeForm:Fe},props:{newsletter:{type:Object,required:!0},extantSubscriber:{type:Object},subscriberEmail:{type:String},stripePublicKey:{type:String,required:!0},variant:{type:String,required:!0}},data(){return{state:"not_subscribed",emailAddress:this.subscriberEmail||"",metadata:{},subscriber:this.extantSubscriber,error:""}},watch:{emailAddress:z(function(){return f(this,null,function*(){this.extantSubscriber||this.checkSubscriber()})},500),newsletter:{handler(){this.state=v(this.subscriber)},immediate:!0},subscriber:{handler(){this.state=v(this.subscriber),this.subscriber&&(this.emailAddress=this.subscriber.email)},immediate:!0}},methods:{subscribe(){return f(this,null,function*(){this.state="pending_subscription";const{subscriber:e,error:t}=yield se(this.emailAddress,this.metadata,this.newsletter,REFERRING_SUBSCRIBER_ID);e?(this.subscriber=e,this.state=v(e),this.newsletter.subscription_redirect_url&&(window.location.href=this.newsletter.subscription_redirect_url)):(this.state="invalid_subscription",t&&(this.error=t))})},resubscribe(e){return f(this,null,function*(){this.state="pending_subscription",R.configure({baseUrl:"/v1",init:{headers:new Headers({Authorization:`Token ${this.newsletter.id}`})}});const t=yield R.path("/subscribers/{pk}").method("patch").create()({pk:e,subscriber_type:"regular"});this.subscriber=t.data})},checkSubscriber(){return f(this,null,function*(){if(this.emailAddress.length===0||!this.emailAddress.includes("@"))return;this.state="pending_validation";const e=yield w.post(S["check-subscriber-email"](),{email_address:this.emailAddress,newsletter_id:this.newsletter.id});e.data.subscriber?this.subscriber=e.data.subscriber:e.data.is_valid===void 0?(this.state="errored_email",this.error=e.data.error):e.data.is_valid?this.state="not_subscribed":(this.state="invalid_email",this.error=e.data.error)})},confirmEmailAddress(){return f(this,null,function*(){this.state="pending_email_address_confirmation",yield w.post(S["start-email-confirmation"](),{email:this.emailAddress,newsletter_id:this.newsletter.id}),this.state="awaiting_email_address_confirmation"})}}});function Ye(e,t,a,p,m,g){const i=A("subscribe-form");return r(),n(i,{emailAddress:e.emailAddress,"onUpdate:emailAddress":t[0]||(t[0]=l=>e.emailAddress=l),metadata:e.metadata,"onUpdate:metadata":t[1]||(t[1]=l=>e.metadata=l),newsletter:e.newsletter,subscriber:e.subscriber,"stripe-public-key":e.stripePublicKey,"confirm-email-address":e.confirmEmailAddress,"check-subscriber":e.checkSubscriber,subscribe:e.subscribe,resubscribe:e.resubscribe,state:e.state,variant:e.variant,error:e.error},null,8,["emailAddress","metadata","newsletter","subscriber","stripe-public-key","confirm-email-address","check-subscriber","subscribe","resubscribe","state","variant","error"])}const Ne=U(Te,[["render",Ye]]);G.overrideDefaults({theme:"bootstrap-v4",layout:"topCenter",timeout:2e3});console.log(W);const B=()=>Z(Ne,{newsletter:NEWSLETTER,stripePublicKey:STRIPE_PUBLIC_KEY,extantSubscriber:SUBSCRIBER,subscriberEmail:SUBSCRIBER_EMAIL,variant:VARIANT});w.defaults.xsrfHeaderName="X-CSRFToken";const C=B();X({app:C,dsn:"https://98d0ca1c1c554806b630fa9caf185b1f@o97520.ingest.sentry.io/6063581",integrations:[new Q({tracingOrigins:["buttondown.email"]})],tracesSampleRate:1,ignoreErrors:["Non-Error","Can't find variable: pktAnnotationHighlighter","ChunkLoadError"]});C.mount("#subscribe-form");C.config.errorHandler=e=>{J(e)};const je=document.getElementsByClassName("subscribe-form");Array.from(je).forEach(e=>{B().mount(e)})});export default Le();
//# sourceMappingURL=subscribe_form-5bf44218.js.map
